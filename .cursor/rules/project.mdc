---
description: Top-level rules and information for the project
alwaysApply: true
---
# Deno MCP Template Development Guide

Deno version: ^2.6.0

## Build/Development Commands

Start: `deno task start`
Dev mode: `deno task dev`
Format, lint, and type-check code: `deno task ci`

## Project Structure

The code is structured to be easily parsable by an AI agent. Files are grouped by feature, and ideally less than 200 lines of code.

```markdown
deno.json     # Project configuration
main.ts       # The main entry point
src/
├── app/
│   ├── http/
│   │   ├── handlers.ts             # HTTP handlers for the MCP server (GET, POST, etc.)
│   │   ├── hono.ts                 # Manages the Hono server, middleware, and routes
│   │   ├── kvEventStore.ts         # Simple Deno KV event store for session resumability
│   │   ├── mod.ts                  # The main entrypoint for the HTTP server
│   │   └── transport.ts            # Manages StreamableHTTPServerTransports
│   ├── kv/
│   │   ├── mod.ts                  # Exports Deno KV store and watcher helpers
│   │   ├── store.ts                # Deno KV open/close lifecycle and config
│   │   └── watch.ts                # Subscription watcher for resource updates
│   ├── app.ts                      # The main application class
│   ├── cli.ts                      # Parses CLI args and env vars into an AppConfig object
│   ├── cron.ts                     # Scheduled jobs (e.g., stale task cleanup)
│   ├── permissions.ts              # Runtime permission preflight checks
│   ├── signals.ts                  # Signal handling for SIGINT, SIGTERM, etc.
│   └── stdio.ts                    # The STDIO transport & state manager
├── mcp/
│   ├── prompts/
│   │   ├── codeReview.ts           # A code-review prompt example
│   │   ├── languagePrompt.ts       # A prompt example with arguments
│   │   └── mod.ts                  # Provides a single point of export for all MCP prompts
│   ├── resources/
│   │   ├── counter.ts              # A stateful resource example
│   │   ├── counterStore.ts         # Persistence for counter resource state
│   │   ├── greetings.ts            # A dynamic resource template example
│   │   ├── helloWorld.ts           # A direct resource example
│   │   ├── kvKeys.ts               # Shared keys used for KV-backed resources
│   │   ├── subscriptionTracker.ts  # Tracks active resource subscriptions
│   │   └── mod.ts                  # Provides a single point of export for all MCP resources
│   ├── tasks/
│   │   ├── kvTaskStore.ts          # Durable task state storage in Deno KV
│   │   ├── queue.ts                # Delayed task queue worker
│   │   └── mod.ts                  # Exports task queue and task store
│   ├── tools/
│   │   ├── delayedEchoTask.ts      # A task-based async tool example
│   │   ├── domain.ts               # A tool that fetches website info via HTTP HEAD request
│   │   ├── elicitInput.ts          # An elicitation tool example
│   │   ├── guidedPoemTask.ts       # A task + sampling workflow example
│   │   ├── incrementCounter.ts     # A tool that updates a resource-backed counter
│   │   ├── logMessage.ts           # A logging notification example
│   │   ├── notifyListChanged.ts    # A list-changed notification example
│   │   ├── poem.ts                 # A sampling tool example
│   │   ├── sandbox.ts              # Sandboxed code execution via Deno Sandbox (microVM)
│   │   └── mod.ts                  # Provides a single point of export for all MCP tools
│   └── mod.ts                      # Creates and configures the MCP server
├── shared/
│   ├── constants/  
│   │   ├── app.ts                  # Constants for the App (e.g., name, description, etc.)
│   │   ├── http.ts                 # Constants for the HTTP server (e.g., headers, ports, etc.)
│   │   └── mcp.ts                  # Constants for the MCP server (e.g., capabilities, etc.)
│   ├── validation/
│   │   ├── config.ts               # Validation of the AppConfig object
│   │   ├── header.ts               # Validation for headers
│   │   ├── host.ts                 # Validation for hosts
│   │   ├── hostname.ts             # Validation for hostnames
│   │   ├── origin.ts               # Validation for origins
│   │   └── port.ts                 # Validation for ports
│   ├── constants.ts                # Single point of export for all shared constants
│   ├── types.ts                    # Shared types
│   ├── utils.ts                    # Shared utility functions
│   └── validation.ts               # Single point of export for all shared validation functions
static/
├── .well-known/
│   ├── llms.txt                    # An example llms.txt giving LLMs information about the server
│   └── openapi.yaml                # An example OpenAPI specification for the server
├── 404.html                        # Default static 404 page
└── dxt-manifest.json               # The manifest for the DXT package
```

## Code Style Guidelines

Deno: This project uses Deno exclusively. Follow Deno standards and best practice.
Imports: Use JSR imports (`jsr:`) or npm imports (`npm:`) with explicit paths. ES module style, include `.ts` extension. Group imports logically.
Structure: The entrypoint is `main.ts`. Core functionality is in `src/`. `src/app` wraps the MCP server from `src/mcp` in some convenience functions for serving HTTP, etc.
TypeScript: Strict type checking, ES modules, explicit return types
Naming: PascalCase for classes/types, camelCase for functions/variables
Files: Lowercase with hyphens, test files with .test.ts suffix
Error Handling: Use TypeScript's strict mode, explicit error checking in tests
Formatting: 2-space indentation, semicolons required, double quotes preferred
Testing: Locate tests in `test/`, use descriptive test names. We use `deno test` for testing.
Comments: JSDoc for public APIs, inline comments for complex logic

## Best Practices

Environment Variables: Parse env vars and CLI flags in `src/app/cli.ts`. Local run tasks load `.env` via `--env-file=.env`.
File Paths: Use `@std/path` for cross-platform file path handling
Data Validation: Use `zod` schemas for data validation
HTTP Responses: Return proper status codes and structured JSON responses, including JSONRPC when necessary.
Transactions: Use `kv.atomic()` for Deno KV transactions when updating multiple records
Error Handling: Provide detailed error messages but avoid exposing sensitive information
Tool Implementation: Follow the MCP schema for defining tool schemas and handlers

## Docs

[MCP Spec](https://modelcontextprotocol.io/specification/2025-06-18)
[MCP Concepts](https://modelcontextprotocol.io/docs/concepts/)
[MCP Server Features](https://modelcontextprotocol.io/specification/2025-06-18/server/index)
[Hono Docs](https://hono.dev/docs/)
[Deno Docs](https://docs.deno.com/)
[Zod Docs](https://zod.dev/)
